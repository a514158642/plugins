(function(d){var e=function(b,a){this.element=b;this.file=b[0].files[0];this.url="";this.default={showImage:"",width:375,quality:.8,callBack:function(){}};this.options=d.extend({},this.default,a)};e.prototype.compress=function(b){var a=document.createElement("canvas"),c=this.options.width/b.width;this.options.width>b.width&&(c=1);a.width=b.width*c;a.height=b.height*c;a.getContext("2d").drawImage(b,0,0,a.width,a.height);return a.toDataURL(this.file.type,this.options.quality).replace("data:"+this.file.type+
";base64,","")};e.prototype.getImages=function(){var b=this,a=b.file;if(!/image\/\w+/.test(a.type))return alert("\u8bf7\u9009\u62e9\u56fe\u7247"),b.element.val(""),!1;var c=new FileReader;c.readAsDataURL(a);c.onload=function(a){a=this.result;d("#"+b.options.showImage)&&d("#"+b.options.showImage).attr({src:a});var c=new Image;c.src=a;c.onload=function(){d.ajax({type:"post",url:b.options.url,contentType:"application/json",dataType:"json",data:JSON.stringify({base64:b.compress(c)}),success:function(a){b.options.callBack(a)}})}}};
d.fn.upLoadImg=function(b){var a=this;a.change(function(){(new e(a,b)).getImages()})}})(jQuery);